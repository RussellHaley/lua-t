Only in lua-5.2.2.rel/src/: .loadlib.c.swp
Only in lua-5.2.2.rel/src/: .lua.c.swp
Only in lua-5.2.2.rel/src/: .luaconf.h.swp
diff -ru lua-5.2.2/src/loadlib.c lua-5.2.2.rel/src/loadlib.c
--- lua-5.2.2/src/loadlib.c	2012-05-30 05:33:44.000000000 -0700
+++ lua-5.2.2.rel/src/loadlib.c	2013-11-13 15:41:08.775577347 -0800
@@ -640,13 +640,27 @@
   if (path == NULL)  /* no environment variable? */
     path = getenv(envname2);  /* try alternative name */
   if (path == NULL || noenv(L))  /* no environment variable? */
+#ifndef _WIN32
+  {
+    lua_getglobal(L, "_LUA_ROOT");
+    luaL_gsub(L, def, LUA_ROOT, luaL_checkstring(L, -1) );
+    lua_remove(L, -2); // remove LUA_ROOT
+  }
+#else
     lua_pushstring(L, def);  /* use default */
+#endif
   else {
     /* replace ";;" by ";AUXMARK;" and then AUXMARK by default path */
     path = luaL_gsub(L, path, LUA_PATH_SEP LUA_PATH_SEP,
                               LUA_PATH_SEP AUXMARK LUA_PATH_SEP);
-    luaL_gsub(L, path, AUXMARK, def);
-    lua_remove(L, -2);
+    path = luaL_gsub(L, path, AUXMARK, def);
+#ifndef _WIN32
+    lua_getglobal(L, "LUA_ROOT");
+    luaL_gsub(L, path, LUA_ROOT, luaL_checkstring(L, -1) );
+    lua_remove(L, -2); // remove LUA_ROOT
+    lua_remove(L, -2); // remove AUXMARK->def path
+#endif
+    lua_remove(L, -2); // remove ;; -> AUXMARK path
   }
   setprogdir(L);
   lua_setfield(L, -2, fieldname);
diff -ru lua-5.2.2/src/lua.c lua-5.2.2.rel/src/lua.c
--- lua-5.2.2/src/lua.c	2012-09-29 13:07:06.000000000 -0700
+++ lua-5.2.2.rel/src/lua.c	2013-11-13 15:41:38.215577195 -0800
@@ -9,6 +9,7 @@
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
+#include <libgen.h>   //dirname()
 
 #define lua_c
 
@@ -452,6 +453,10 @@
     lua_pushboolean(L, 1);  /* signal for libraries to ignore env. vars. */
     lua_setfield(L, LUA_REGISTRYINDEX, "LUA_NOENV");
   }
+#ifndef _WIN32
+  lua_pushfstring(L, "%s/", dirname(dirname(argv[0])));
+  lua_setglobal(L, "_LUA_ROOT");
+#endif
   /* open standard libraries */
   luaL_checkversion(L);
   lua_gc(L, LUA_GCSTOP, 0);  /* stop collector during initialization */
diff -ru lua-5.2.2/src/luaconf.h lua-5.2.2.rel/src/luaconf.h
--- lua-5.2.2/src/luaconf.h	2013-03-16 14:10:18.000000000 -0700
+++ lua-5.2.2.rel/src/luaconf.h	2013-11-13 14:10:01.595995788 -0800
@@ -100,7 +100,7 @@
 #else			/* }{ */
 
 #define LUA_VDIR	LUA_VERSION_MAJOR "." LUA_VERSION_MINOR "/"
-#define LUA_ROOT	"/usr/local/"
+#define LUA_ROOT	".../"
 #define LUA_LDIR	LUA_ROOT "share/lua/" LUA_VDIR
 #define LUA_CDIR	LUA_ROOT "lib/lua/" LUA_VDIR
 #define LUA_PATH_DEFAULT  \
